# -*- coding: utf-8 -*-

import telebot
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
import subprocess
import threading
import datetime
import os
import signal

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#             Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙˆØ¶Ø¹ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§                 #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
BOT_TOKEN = "8053389792:AAHNFNCsgFXMn_qFt2VKM6yKWPlgoNz5WQY"
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

# ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙˆØª
bot = telebot.TeleBot(BOT_TOKEN)

# Ù‚Ø§Ù…ÙˆØ³ Ù„ØªØ®Ø²ÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø« (Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø­Ø¯Ø©)
# Ù‡Ø°Ø§ ÙŠØ³Ù…Ø­ Ù„Ø¹Ø¯Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª Ø¯ÙˆÙ† ØªØ¯Ø§Ø®Ù„
stream_states = {}

def get_user_state(user_id):
    """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©"""
    if user_id not in stream_states:
        stream_states[user_id] = {
            "is_streaming": False,
            "process": None,
            "input_url": None,
            "rtmp_url": None,
            "start_time": None,
            "last_message_id": None,
        }
    return stream_states[user_id]

def gen_main_keyboard(user_id):
    """Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…"""
    state = get_user_state(user_id)
    markup = InlineKeyboardMarkup(row_width=2)

    # Ø²Ø± Ø¨Ø¯Ø¡/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«
    if state["is_streaming"]:
        start_stop_button = InlineKeyboardButton("â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«", callback_data="stop_stream")
    else:
        start_stop_button = InlineKeyboardButton("â–¶ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«", callback_data="start_stream")

    # Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø­Ø§Ù„Ø©
    set_input_button = InlineKeyboardButton("ğŸ“¥ Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„", callback_data="set_input")
    set_rtmp_button = InlineKeyboardButton("ğŸ“¤ Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø§Ø¨Ø· RTMP", callback_data="set_rtmp")
    status_button = InlineKeyboardButton("ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©", callback_data="status")

    markup.add(start_stop_button)
    markup.add(set_input_button, set_rtmp_button)
    markup.add(status_button)
    return markup

def get_status_message(user_id):
    """ØªÙ†Ø³ÙŠÙ‚ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…"""
    state = get_user_state(user_id)
    status_icon = "ğŸŸ¢ (Ù†Ø´Ø·)" if state["is_streaming"] else "ğŸ”´ (Ù…ØªÙˆÙ‚Ù)"
    
    # Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø¨Ø«
    uptime = "N/A"
    if state["is_streaming"] and state["start_time"]:
        duration = datetime.datetime.now() - state["start_time"]
        total_seconds = int(duration.total_seconds())
        hours, remainder = divmod(total_seconds, 3600)
        minutes, seconds = divmod(remainder, 60)
        uptime = f"{hours:02}:{minutes:02}:{seconds:02}"

    # ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
    input_url_display = state["input_url"] if state["input_url"] else "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†"
    rtmp_url_display = state["rtmp_url"] if state["rtmp_url"] else "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†"

    # Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
    message = (
        f"ğŸ–¥ï¸ **Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø«** ğŸ–¥ï¸\n\n"
        f"**Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:** {status_icon}\n"
        f"**Ù…Ø¯Ø© Ø§Ù„Ø¨Ø«:** `{uptime}`\n\n"
        f"ğŸ”— **Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (HLS/Video):**\n`{input_url_display}`\n\n"
        f"ğŸ“¡ **Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ (RTMP):**\n`{rtmp_url_display}`\n\n"
        f"Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨Ø«."
    )
    return message

def run_ffmpeg_process(user_id):
    """ØªØ´ØºÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© FFmpeg ÙÙŠ thread Ù…Ù†ÙØµÙ„"""
    state = get_user_state(user_id)
    
    if not state["input_url"] or not state["rtmp_url"]:
        bot.send_message(user_id, "Ø®Ø·Ø£: ÙŠØ¬Ø¨ ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø¥Ø®Ø±Ø§Ø¬ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«.")
        return

    # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
    state["is_streaming"] = True
    state["start_time"] = datetime.datetime.now()
    update_status_message(user_id)

    # Ø£Ù…Ø± FFmpeg
    # -re: ÙŠÙ‚Ø±Ø£ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ
    # -c:v copy: ÙŠÙ†Ø³Ø® ØªØ±Ù…ÙŠØ² Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ±Ù…ÙŠØ² (Ø£Ø³Ø±Ø¹ ÙˆØ£Ù‚Ù„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒØ§Ù‹ Ù„Ù„Ù…ÙˆØ§Ø±Ø¯)
    # -c:a aac: ÙŠØ¹ÙŠØ¯ ØªØ±Ù…ÙŠØ² Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ AAC ÙˆÙ‡Ùˆ Ù…ØªÙˆØ§ÙÙ‚ Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ± Ù…Ø¹ RTMP
    # -f flv: ÙŠØ­Ø¯Ø¯ ØµÙŠØºØ© Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ Ø¥Ù„Ù‰ FLV (Flash Video) ÙˆÙ‡ÙŠ Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ RTMP
    command = [
        'ffmpeg', '-re', '-i', state["input_url"],
        '-c:v', 'copy', '-c:a', 'aac', '-ar', '44100', '-b:a', '128k',
        '-f', 'flv', state["rtmp_url"]
    ]
    
    try:
        # Ø§Ø³ØªØ®Ø¯Ø§Ù… Popen Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        # preexec_fn=os.setsid ÙŠØ³Ù…Ø­ Ø¨Ù‚ØªÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆÙ…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ù…ÙˆØ«ÙˆÙ‚
        process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, preexec_fn=os.setsid)
        state["process"] = process
        
        # Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        process.wait()

    except FileNotFoundError:
        bot.send_message(user_id, "Ø®Ø·Ø£ ÙØ§Ø¯Ø­: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ FFmpeg. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ«Ø¨ÙŠØªÙ‡ ÙˆØ¥Ø¶Ø§ÙØªÙ‡ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… (PATH).")
    except Exception as e:
        bot.send_message(user_id, f"Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ ØªØ´ØºÙŠÙ„ FFmpeg: {e}")
    finally:
        # ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ø« Ø£Ùˆ ÙØ´Ù„Ù‡
        state["is_streaming"] = False
        state["process"] = None
        state["start_time"] = None
        update_status_message(user_id)
        bot.send_message(user_id, "â„¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø« (Ø¥Ù…Ø§ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ Ø£Ùˆ Ø¨Ø³Ø¨Ø¨ Ø®Ø·Ø£).")


def stop_streaming_process(user_id):
    """Ø¥ÙŠÙ‚Ø§Ù Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨Ø« Ø§Ù„Ø­Ø§Ù„ÙŠØ©"""
    state = get_user_state(user_id)
    if state["is_streaming"] and state["process"]:
        try:
            # Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø© SIGTERM Ø¥Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù„Ø¶Ù…Ø§Ù† Ø¥ØºÙ„Ø§Ù‚ FFmpeg Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„
            os.killpg(os.getpgid(state["process"].pid), signal.SIGTERM)
            bot.send_message(user_id, "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø¨Ù†Ø¬Ø§Ø­.")
        except ProcessLookupError:
            # ÙÙŠ Ø­Ø§Ù„ ÙƒØ§Ù†Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù‚Ø¯ Ø§Ù†ØªÙ‡Øª Ø¨Ø§Ù„ÙØ¹Ù„
            pass
        except Exception as e:
            bot.send_message(user_id, f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«: {e}")
        finally:
            # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙˆØ±Ø§Ù‹
            state["is_streaming"] = False
            state["process"] = None
            state["start_time"] = None
    else:
        bot.send_message(user_id, "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø« Ù†Ø´Ø· Ù„Ø¥ÙŠÙ‚Ø§ÙÙ‡.")
    
    update_status_message(user_id)


def update_status_message(user_id):
    """ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ø­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©"""
    state = get_user_state(user_id)
    chat_id = user_id
    message_id = state.get("last_message_id")
    text = get_status_message(user_id)
    markup = gen_main_keyboard(user_id)

    try:
        if message_id:
            bot.edit_message_text(chat_id=chat_id, message_id=message_id, text=text, reply_markup=markup, parse_mode="Markdown")
        else:
            # Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø±Ø³Ø§Ù„Ø© Ø³Ø§Ø¨Ù‚Ø©ØŒ Ø£Ø±Ø³Ù„ ÙˆØ§Ø­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
            sent_message = bot.send_message(chat_id, text, reply_markup=markup, parse_mode="Markdown")
            state["last_message_id"] = sent_message.message_id
    except telebot.apihelper.ApiTelegramException as e:
        # Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù…Ø«Ù„Ø§Ù‹ØŒ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©)ØŒ Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        if "message to edit not found" in e.description:
            sent_message = bot.send_message(chat_id, text, reply_markup=markup, parse_mode="Markdown")
            state["last_message_id"] = sent_message.message_id


@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    """Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆÙ„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„"""
    user_id = message.from_user.id
    welcome_text = (
        "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¨Ø«!\n"
        "Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØª ÙŠØ³Ù…Ø­ Ù„Ùƒ Ø¨Ø¨Ø« Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø£ÙŠ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± Ø£Ùˆ HLS Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù… RTMP."
    )
    bot.send_message(user_id, welcome_text)
    update_status_message(user_id) # Ø¥Ø±Ø³Ø§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…

@bot.callback_query_handler(func=lambda call: True)
def handle_callback_query(call):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¶ØºØ·Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±"""
    user_id = call.from_user.id
    state = get_user_state(user_id)
    
    # ØªØ®Ø²ÙŠÙ† message_id Ù„ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
    state["last_message_id"] = call.message.message_id

    if call.data == "start_stream":
        if state["is_streaming"]:
            bot.answer_callback_query(call.id, "Ø§Ù„Ø¨Ø« Ù†Ø´Ø· Ø¨Ø§Ù„ÙØ¹Ù„!", show_alert=True)
        elif not state["input_url"] or not state["rtmp_url"]:
            bot.answer_callback_query(call.id, "ÙŠØ±Ø¬Ù‰ ØªØ¹ÙŠÙŠÙ† Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø¥Ø®Ø±Ø§Ø¬ Ø£ÙˆÙ„Ø§Ù‹.", show_alert=True)
        else:
            bot.answer_callback_query(call.id, "â³ Ø¬Ø§Ø±Ù Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«...")
            # Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« ÙÙŠ thread Ø¬Ø¯ÙŠØ¯ Ù„Ù…Ù†Ø¹ Ø­Ø¸Ø± Ø§Ù„Ø¨ÙˆØª
            threading.Thread(target=run_ffmpeg_process, args=(user_id,)).start()
    
    elif call.data == "stop_stream":
        bot.answer_callback_query(call.id, "â³ Ø¬Ø§Ø±Ù Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«...")
        stop_streaming_process(user_id)

    elif call.data == "set_input":
        msg = bot.send_message(user_id, "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (HLS Ø£Ùˆ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ Ù…Ø¨Ø§Ø´Ø±):")
        bot.register_next_step_handler(msg, process_input_url_step)

    elif call.data == "set_rtmp":
        msg = bot.send_message(user_id, "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ (RTMP) ÙƒØ§Ù…Ù„Ø§Ù‹ Ù…Ø¹ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¨Ø«:")
        bot.register_next_step_handler(msg, process_rtmp_url_step)

    elif call.data == "status":
        bot.answer_callback_query(call.id, "ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©.")
        update_status_message(user_id)

def process_input_url_step(message):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø°ÙŠ ÙŠØ±Ø³Ù„Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"""
    user_id = message.from_user.id
    state = get_user_state(user_id)
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¨Ø¯Ø£ Ø¨Ù€ http
    if message.text.startswith("http"):
        state["input_url"] = message.text
        bot.send_message(user_id, "âœ… ØªÙ… Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­.")
    else:
        bot.send_message(user_id, "âŒ Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ http Ø£Ùˆ https.")
    
    update_status_message(user_id)

def process_rtmp_url_step(message):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ø°ÙŠ ÙŠØ±Ø³Ù„Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"""
    user_id = message.from_user.id
    state = get_user_state(user_id)
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¨Ø¯Ø£ Ø¨Ù€ rtmp
    if message.text.startswith("rtmp"):
        state["rtmp_url"] = message.text
        bot.send_message(user_id, "âœ… ØªÙ… Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ (RTMP) Ø¨Ù†Ø¬Ø§Ø­.")
    else:
        bot.send_message(user_id, "âŒ Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ rtmp:// Ø£Ùˆ rtmps://.")
    
    update_status_message(user_id)


print("Ø§Ù„Ø¨ÙˆØª Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„...")
# Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
bot.polling(none_stop=True)

